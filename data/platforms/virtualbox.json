{
  "include": "all",
  "arches": [
    "i386",
    "x86_64"
  ],
  "defs": {
    "local": true
  },
  "variables": {
    "name": "{{ build_name }}"
  },
  "config": {
    "type": "virtualbox-iso",
    "vm_name": "{{user `name`}}",
    "output_directory": ">>vms_path<</vbox/{{user `name`}}",
    "headless": true,
    "skip_export": true,
    "keep_registered": true,
    "disable_shutdown": false,
    "guest_additions_mode": "disable",
    "cpus": "#>cpu_sockets*cpu_cores<#",
    "memory": "#>memory<#",
    "firmware": ">>firmware<<",
    "gfx_controller": "vmsvga",
    "gfx_vram_size": 32,
    "usb": true,
    "iso_url": "E>'>>iso_path<<>>iso_name<<' if >>local_only<< else '>>iso_url<<'<E",
    "iso_checksum": "E>'>>iso_checksum<<' if len('>>iso_checksum<<') else 'none'<E",
    "iso_target_path": "E>'' if >>local_only<< else '>>iso_path<<>>iso_name<<'<E",
    "cd_files": "%>cd_files<%",
    "cd_label": ">>cd_label<<",
    "vboxmanage": [
      [
        "movevm",
        "{{.Name}}",
        "--folder=>>vms_path<</vbox"
      ],
      [
        "modifyvm",
        "{{.Name}}",
        "--nic-type1=virtio",
        "--nic1=bridged",
        "--bridge-adapter1=vbnet"
      ],
      [
        "modifyvm",
        "{{.Name}}",
        "--ioapic", "on",
        "--rtcuseutc","on",
        "--hwvirtex","on",
        "--vtxvpid","on",
        "--nestedpaging","on"
      ]

    ],
    "hard_drive_discard": true,
    "hard_drive_nonrotational": true,
    "hard_drive_interface": "virtio",
    "disk_size": "#>boot_disk_size<#",
    "skip_nat_mapping": true
  }
}
