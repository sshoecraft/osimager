%firstboot --interpreter=busybox
exec > /scratch/firstboot.log 2>&1
set -x
vim-cmd hostsvc/enable_ssh
vim-cmd hostsvc/enable_esx_shell
esxcli system settings advanced set -o /UserVars/SuppressShellWarning -i 1
esxcli system maintenanceMode set --enable true
esxcli network ip set --ipv6-enabled=false
esxcli network ip interface ipv4 set -i vmk0 -t dhcp -P false
esxcli network ip dns server add --server=>>dns1<<
esxcli system hostname set --fqdn=>>fqdn<<
vol=`df | sort -rnk 2 | head -1 | awk '{ print $NF }'`
if test -n "$vol"; then
    if test -f $vol/TOOLS.VIB; then
        esxcli software vib install -v $vol/TOOLS.VIB
        rm -f $vol/TOOLS.VIB
    fi
fi
reboot
